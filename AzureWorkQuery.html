<html>
  <body></body>
  <script>
    //security is joseph_jorden@uhaul.com:PAT base64 encoded
    const apiUrl =
      "https://dev.azure.com/uhaul/U-Haul%20IT/_apis/wit/wiql/%7B3772faaa-ed72-44d9-90ac-2067d20937e5%7D?api-version=7.1-preview.2";

    (async () => {
      const rawResponse = await fetch(apiUrl, {
        headers: {
          Authorization:
            "Basic am9zZXBoX2pvcmRlbkB1aGF1bC5jb206aGNpd2tydTJ3d2Uybnhycnh5aDZ3Y2p2bTdobHhsd2VqdXFhbHUyZmhsM2psZmpkNGV2YQ==",
          Accept: "application/json, text/plain, */*",
          "Content-type": "application/json; charset=UTF-8",
        },
      }).catch((error) => console.error("Error:", error));

      const content = await rawResponse.json();

      for (var workItem of content.workItems) {
        var wid = workItem.id;
        var workitemUrl =
          "https://dev.azure.com/uhaul/U-Haul%20IT/_apis/wit/workitems/" +
          workItem.id +
          "?api-version=7.1-preview.3";

        const wiResponse = await fetch(workitemUrl, {
          headers: {
            Authorization:
              "Basic am9zZXBoX2pvcmRlbkB1aGF1bC5jb206aGNpd2tydTJ3d2Uybnhycnh5aDZ3Y2p2bTdobHhsd2VqdXFhbHUyZmhsM2psZmpkNGV2YQ==",
            Accept: "application/json, text/plain, */*",
            "Content-type": "application/json; charset=UTF-8",
          },
        }).catch((error) => console.error("Error:", error));

        const wiContent = await wiResponse.json();

        var color = "blue";
        if (wiContent.fields["System.State"] == "Active") color = "green";

        document.write(
          "<div style='background:blue;border:medium solid lightblue'>" +
          "<a target='new' style='color:" +
            color +
            "' href=" +
            wiContent._links["html"]["href"] +
            ">" +
            "(" +
            wid +
            ") " +
            wiContent.fields["System.Title"] +
            "</a></div>" +
            "<br />"
        );
      }
      console.log(content);
    })();
  </script>
</html>
